spring:
  config:
    # application-secret.yml 파일이 있으면 불러오고, 없으면 무시한다.
    # 로컬에서는 이 파일이 로드되어 아래의 ${...} 설정을 실제 값으로 덮어쓰게 된다.
    import: optional:classpath:application-secret.yml
  application:
    name: moment-canvas

  # [DB 설정]
  datasource:
    url: jdbc:mysql://mysql:3306/moment_canvas?serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: root
    password: ${DB_PASSWORD} # Env에서 주입

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true # 운영 배포시에는 false로 끄는 것을 권장하지만, 일단 유지

  # [Redis 설정]
  data:
    redis:
      host: redis
      port: 6379
      # password: ${REDIS_PASSWORD} # Env에서 주입 (없으면 비워둠)

  # [JWT 설정]
  jwt:
    secret: ${JWT_SECRET} # Env에서 주입
    access-token-expiration: 3600000       # 1시간
    refresh-token-expiration: 1209600000   # 2주

  # [AI 설정]
  ai:
    provider: replicate
    openai:
      api-key: ${OPENAI_API_KEY} # Env에서 주입
      image:
        options:
          model: dall-e-3
          style: vivid
          width: 1792
          height: 1024
          n: 1
    replicate:
      api-token: ${REPLICATE_API_TOKEN} # Env에서 주입

  # [OAuth2 설정]
  security:
    oauth2:
      client:
        registration:
          kakao:
            client-id: ${KAKAO_CLIENT_ID}         # Env
            client-secret: ${KAKAO_CLIENT_SECRET} # Env
            client-authentication-method: client_secret_post
            authorization-grant-type: authorization_code
            redirect-uri: ${OAUTH_REDIRECT_URI}/login/oauth2/code/kakao # 도메인에 따라 변경됨
            scope:
              - profile_nickname
              - account_email
            client-name: Kakao

          google:
            client-id: ${GOOGLE_CLIENT_ID}         # Env
            client-secret: ${GOOGLE_CLIENT_SECRET} # Env
            redirect-uri: ${OAUTH_REDIRECT_URI}/login/oauth2/code/google
            scope:
              - profile
              - email

        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id

          google:
            # 구글은 스프링이 기본 제공하지만 명시적으로 적어도 무방함
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub



server:
  port: 9090

---
# [Prod 프로필: 배포 환경]
spring:
  config:
    activate:
      on-profile: prod

# [파일 업로드 경로]
file:
  upload-dir: ${FILE_UPLOAD_DIR:/app/images/}

# [AWS S3 설정]
cloud:
  aws:
    s3:
      bucket: moment-canvas
    region:
      static: ap-northeast-2
    stack:
      auto: false
    credentials:
      access-key: ${AWS_ACCESS_KEY} # Env
      secret-key: ${AWS_SECRET_KEY} # Env

---
# [Default 프로필: 로컬 개발 환경]
# Prod가 아닐 때 적용될 설정
spring:
  config:
    activate:
      on-profile: default

  # 로컬 DB 주소 (Docker 내부의 mysql이 아니라 localhost)
  datasource:
    url: jdbc:mysql://localhost:3307/moment_canvas?serverTimezone=Asia/Seoul&characterEncoding=UTF-8

  # 로컬 Redis 주소
  data:
    redis:
      host: localhost

# 로컬 파일 저장 경로
file:
  upload-dir: file:../../images/